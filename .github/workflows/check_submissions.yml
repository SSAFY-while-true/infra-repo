name: Check Algorithm Study & Send Discord Alerts

on:
  schedule:
    # ë§¤ì£¼ ì¼ìš”ì¼ 0ì‹œ (UTC 15ì‹œ â†’ KST 0ì‹œ)ì— ë¬¸ì œ ê²€ì‚¬
    # - cron: '0 15 * * 0'

    # í…ŒìŠ¤íŠ¸ìš©: 2ì›” 14ì¼ ì˜¤í›„ 4ì‹œ 50ë¶„(KST) ì‹¤í–‰
    - cron: '50 7 * * *'
    # ë§¤ì£¼ í† ìš”ì¼ 22ì‹œ (UTC 13ì‹œ â†’ KST 22ì‹œ)ì— ë¦¬ë§ˆì¸ë“œ ì•Œë¦¼
    - cron: '0 13 * * 6'
  workflow_dispatch:

jobs:
  check-submissions:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install requests PyGithub

      # 1) ë§¤ì£¼ ì¼ìš”ì¼ì—ë§Œ ì£¼ì°¨ í´ë” ê²€ì‚¬ & ë³´ê³ 
      - name: Run submission check script
        if: >
          github.event_name == 'workflow_dispatch' ||
          (github.event_name == 'schedule' && github.event.schedule == '0 15 * * 0')
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: python scripts/check_submissions.py

      # 2) ë§¤ì£¼ í† ìš”ì¼ì—ë§Œ ë¦¬ë§ˆì¸ë“œ ë©”ì‹œì§€ ì „ì†¡
      - name: Send Reminder
        if: >
          github.event_name == 'workflow_dispatch' ||
          (github.event_name == 'schedule' && github.event.schedule == '0 13 * * 6')
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          curl -H "Content-Type: application/json" \
            -d "{\"content\": \"ğŸ”” **Reminder!** ğŸ””\n\nì´ë²ˆ ì£¼ ë¬¸ì œ í’€ì´ & í´ë” ì—…ë¡œë“œ ìŠì§€ ë§ˆì„¸ìš”! ğŸ’ª\"}" \
            $DISCORD_WEBHOOK_URL
